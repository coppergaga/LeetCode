# RunLoop

> Run loops are part of the fundamental infrastructure associated with threads.
A run loop is an event processing loop that you use to schedule work and coordinate the receipt of incoming events. The purpose of a run loop is to keep your thread busy when there is work to do and put your thread to sleep when there is none.

RunLoopæ˜¯éƒ¨åˆ†ä¸çº¿ç¨‹ç›¸å…³çš„åŸºç¡€åŠŸèƒ½ã€‚RunLoopæ˜¯ç”¨äºè°ƒåº¦å·¥ä½œï¼Œåè°ƒæ¥æ”¶ä¼ å…¥äº‹ä»¶çš„äº‹ä»¶å¤„ç†å¾ªç¯ã€‚RunLoopçš„ç›®çš„æ˜¯è®©çº¿ç¨‹åœ¨æœ‰ä»»åŠ¡æ—¶å·¥ä½œï¼Œæ— ä»»åŠ¡æ—¶ä¼‘çœ ã€‚

çº¿ç¨‹åœ¨å¤„ç†å®Œè‡ªå·±çš„ä»»åŠ¡åä¸€èˆ¬ä¼šé€€å‡ºï¼ŒRunLoopå¯ä»¥è®©çº¿ç¨‹åœ¨æ²¡æœ‰ä»»åŠ¡æ—¶ä¹Ÿä¸é€€å‡ºï¼Œè€Œæ˜¯ä¿æŒé—²ç­‰çŠ¶æ€ï¼ˆå…¶ä»–æ“ä½œç³»ç»Ÿä¸­çš„EventLoopï¼‰ã€‚

çº¿ç¨‹å’ŒRunLoopæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¯¹åº”å…³ç³»ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€å­—å…¸å½“ä¸­ã€‚çº¿ç¨‹åˆšåˆ›å»ºæ—¶æ²¡æœ‰RunLoopï¼Œç›´åˆ°ç¬¬ä¸€æ¬¡ä¸»åŠ¨è·å–RunLoopæ‰ä¼šè¢«ç³»ç»Ÿåˆ›å»ºï¼ŒRunLoopéšçº¿ç¨‹çš„ç»“æŸè€Œé”€æ¯ã€‚RunLoopåªèƒ½åœ¨å¯¹åº”çº¿ç¨‹å†…éƒ¨è·å–ã€‚

# é”ğŸ”

## æ¦‚å¿µ

1. å…¬å¹³é” / éå…¬å¹³é”

> å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ã€‚

> éå…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚æœ‰å¯èƒ½ï¼Œä¼šé€ æˆä¼˜å…ˆçº§åè½¬æˆ–è€…é¥¥é¥¿ç°è±¡ã€‚

2. å¯é‡å…¥é” / ä¸å¯é‡å…¥é”

> å¹¿ä¹‰ä¸Šçš„å¯é‡å…¥é”æŒ‡çš„æ˜¯å¯é‡å¤å¯é€’å½’è°ƒç”¨çš„é”ï¼Œåœ¨å¤–å±‚ä½¿ç”¨é”ä¹‹åï¼Œåœ¨å†…å±‚ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸å‘ç”Ÿæ­»é”ï¼ˆå‰æå¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰

> ä¸å¯é‡å…¥é”ï¼Œä¸å¯é‡å…¥é”ç›¸åï¼Œä¸å¯é€’å½’è°ƒç”¨ï¼Œé€’å½’è°ƒç”¨å°±å‘ç”Ÿæ­»é”ã€‚


3. ç‹¬äº«é” / å…±äº«é”

> ç‹¬äº«é”ï¼šè¯¥é”æ¯ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚

> å…±äº«é”ï¼šè¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹å…±æœ‰

4. äº’æ–¥é” / è¯»å†™é”

äº’æ–¥é”

> åœ¨è®¿é—®å…±äº«èµ„æºä¹‹å‰å¯¹è¿›è¡ŒåŠ é”æ“ä½œï¼Œåœ¨è®¿é—®å®Œæˆä¹‹åè¿›è¡Œè§£é”æ“ä½œã€‚åŠ é”åï¼Œä»»ä½•å…¶ä»–è¯•å›¾å†æ¬¡åŠ é”çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰è¿›ç¨‹è§£é”ã€‚
> 
> å¦‚æœè§£é”æ—¶æœ‰ä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹é˜»å¡ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯¥é”ä¸Šçš„çº¿ç¨‹éƒ½è¢«å˜æˆå°±ç»ªçŠ¶æ€ï¼Œ ç¬¬ä¸€ä¸ªå˜ä¸ºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹åˆæ‰§è¡ŒåŠ é”æ“ä½œï¼Œé‚£ä¹ˆå…¶ä»–çš„çº¿ç¨‹åˆä¼šè¿›å…¥ç­‰å¾…ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®è¢«äº’æ–¥é”ä¿æŠ¤çš„èµ„æº

è¯»å†™é”

> è¯»å†™é”æ—¢æ˜¯äº’æ–¥é”ï¼Œåˆæ˜¯å…±äº«é”ï¼Œreadæ¨¡å¼æ˜¯å…±äº«ï¼Œwriteæ˜¯äº’æ–¥(æ’å®ƒé”)çš„ã€‚
> ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™æ¨¡å¼çš„è¯»å†™é”ï¼Œä½†æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å æœ‰è¯»æ¨¡å¼çš„è¯»å†™é”ã€‚
> 
> åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™çŠ¶æ€çš„é”ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å æœ‰è¯»çŠ¶æ€é”ï¼Œè¿™ä¹Ÿæ˜¯å®ƒå¯ä»¥å®ç°é«˜å¹¶å‘çš„åŸå› ã€‚å½“å…¶å¤„äºå†™çŠ¶æ€é”ä¸‹ï¼Œä»»ä½•æƒ³è¦å°è¯•è·å¾—é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å†™çŠ¶æ€é”è¢«é‡Šæ”¾ï¼›å¦‚æœæ˜¯å¤„äºè¯»çŠ¶æ€é”ä¸‹ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—å®ƒçš„è¯»çŠ¶æ€é”ï¼Œä½†æ˜¯ä¸å…è®¸è·å¾—å®ƒçš„å†™çŠ¶æ€é”ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹çš„è¯»çŠ¶æ€é”è¢«é‡Šæ”¾ï¼›ä¸ºäº†é¿å…æƒ³è¦å°è¯•å†™æ“ä½œçš„çº¿ç¨‹ä¸€ç›´å¾—ä¸åˆ°å†™çŠ¶æ€é”ï¼Œå½“è¯»å†™é”æ„ŸçŸ¥åˆ°æœ‰çº¿ç¨‹æƒ³è¦è·å¾—å†™çŠ¶æ€é”æ—¶ï¼Œä¾¿ä¼šé˜»å¡å…¶åæ‰€æœ‰æƒ³è¦è·å¾—è¯»çŠ¶æ€é”çš„çº¿ç¨‹ã€‚æ‰€ä»¥è¯»å†™é”éå¸¸é€‚åˆèµ„æºçš„è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œçš„æƒ…å†µã€‚

5. ä¹è§‚é” / æ‚²è§‚é”

> ä¹è§‚é”ï¼šæ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®ç°ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äºwrite_conditionæœºåˆ¶ï¼Œå…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚
> 
> æ‚²è§‚é”ï¼šæ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚


6. åˆ†æ®µé”

> åˆ†æ®µé”å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ï¼Œå¯¹äºConcurrentHashMapè€Œè¨€ï¼Œå…¶å¹¶å‘çš„å®ç°å°±æ˜¯é€šè¿‡åˆ†æ®µé”çš„å½¢å¼æ¥å®ç°é«˜æ•ˆçš„å¹¶å‘æ“ä½œã€‚
> 
> å¹¶å‘å®¹å™¨ç±»çš„åŠ é”æœºåˆ¶æ˜¯åŸºäºç²’åº¦æ›´å°çš„åˆ†æ®µé”ï¼Œåˆ†æ®µé”ä¹Ÿæ˜¯æå‡å¤šå¹¶å‘ç¨‹åºæ€§èƒ½çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ã€‚
> 
> åœ¨å¹¶å‘ç¨‹åºä¸­ï¼Œä¸²è¡Œæ“ä½œæ˜¯ä¼šé™ä½å¯ä¼¸ç¼©æ€§ï¼Œå¹¶ä¸”ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿä¼šå‡ä½æ€§èƒ½ã€‚åœ¨é”ä¸Šå‘ç”Ÿç«äº‰æ—¶å°†åŒæ—¶å¯¼è‡´è¿™ä¸¤ç§é—®é¢˜ï¼Œä½¿ç”¨ç‹¬å é”æ—¶ä¿æŠ¤å—é™èµ„æºçš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šæ˜¯é‡‡ç”¨ä¸²è¡Œæ–¹å¼â€”-æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å®ƒã€‚æ‰€ä»¥å¯¹äºå¯ä¼¸ç¼©æ€§æ¥è¯´æœ€å¤§çš„å¨èƒå°±æ˜¯ç‹¬å é”ã€‚

7. åå‘é” / è½»é‡çº§é” / é‡é‡çº§é”

> é”çš„çŠ¶æ€ï¼šæ— é”çŠ¶æ€ï¼Œåå‘é”çŠ¶æ€ï¼Œè½»é‡çº§é”çŠ¶æ€ï¼Œé‡é‡çº§é”çŠ¶æ€
> 
> åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ã€‚é™ä½è·å–é”çš„ä»£ä»·ã€‚
> è½»é‡çº§é”æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚
> é‡é‡çº§é”æ˜¯æŒ‡å½“é”ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è™½ç„¶æ˜¯è‡ªæ—‹ï¼Œä½†è‡ªæ—‹ä¸ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œå½“è‡ªæ—‹ä¸€å®šæ¬¡æ•°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡ï¼Œè¯¥é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·çš„çº¿ç¨‹è¿›å…¥é˜»å¡ï¼Œæ€§èƒ½é™ä½ã€‚

8. è‡ªæ—‹é”

> è‡ªæ—‹é”ï¼ˆspinlockï¼‰ï¼šæ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹åœ¨è·å–é”çš„æ—¶å€™ï¼Œå¦‚æœé”å·²ç»è¢«å…¶å®ƒçº¿ç¨‹è·å–ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°†å¾ªç¯ç­‰å¾…ï¼Œç„¶åä¸æ–­çš„åˆ¤æ–­é”æ˜¯å¦èƒ½å¤Ÿè¢«æˆåŠŸè·å–ï¼Œç›´åˆ°è·å–åˆ°é”æ‰ä¼šé€€å‡ºå¾ªç¯ã€‚
> 
> å®ƒæ˜¯ä¸ºå®ç°ä¿æŠ¤å…±äº«èµ„æºè€Œæå‡ºä¸€ç§é”æœºåˆ¶ã€‚å…¶å®ï¼Œè‡ªæ—‹é”ä¸äº’æ–¥é”æ¯”è¾ƒç±»ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†è§£å†³å¯¹æŸé¡¹èµ„æºçš„äº’æ–¥ä½¿ç”¨ã€‚æ— è®ºæ˜¯äº’æ–¥é”ï¼Œè¿˜æ˜¯è‡ªæ—‹é”ï¼Œåœ¨ä»»ä½•æ—¶åˆ»ï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¿æŒè€…ï¼Œä¹Ÿå°±è¯´ï¼Œåœ¨ä»»ä½•æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæ‰§è¡Œå•å…ƒè·å¾—é”ã€‚ä½†æ˜¯ä¸¤è€…åœ¨è°ƒåº¦æœºåˆ¶ä¸Šç•¥æœ‰ä¸åŒã€‚å¯¹äºäº’æ–¥é”ï¼Œå¦‚æœèµ„æºå·²ç»è¢«å ç”¨ï¼Œèµ„æºç”³è¯·è€…åªèƒ½è¿›å…¥ç¡çœ çŠ¶æ€ã€‚ä½†æ˜¯è‡ªæ—‹é”ä¸ä¼šå¼•èµ·è°ƒç”¨è€…ç¡çœ ï¼Œå¦‚æœè‡ªæ—‹é”å·²ç»è¢«åˆ«çš„æ‰§è¡Œå•å…ƒä¿æŒï¼Œè°ƒç”¨è€…å°±ä¸€ç›´å¾ªç¯åœ¨é‚£é‡Œçœ‹æ˜¯å¦è¯¥è‡ªæ—‹é”çš„ä¿æŒè€…å·²ç»é‡Šæ”¾äº†é”ï¼Œâ€è‡ªæ—‹â€ä¸€è¯å°±æ˜¯å› æ­¤è€Œå¾—åã€‚

## å¤šè¯»å•å†™ - ä¿¡å·é‡å®ç°(P,Vå®ç°è¯»è€…å†™è€…é—®é¢˜)
```swift
semaphore sa
semaphore sc
int readCount = 0

getAValue() {
    sc.wait()
    if (readCount == 0) sa.wait()
    readCount +=1
    sc.signal()
    // read option
    sc.wait()
    readCount -= 1
    if (readCount == 0) sa.signal()
    sc.signal()
}

setAValue(value) {
    sa.wait()
    // write option
    sa.signal()
}
```

```objc
getAValue() -> String {
    dispatch_sync(self.concurrentQueue, ^{
        t = self->_t
    })
    return t
}

setAValue(value) {
    dispatch_barrier_async(self.concurrentQueue, ^{
        self->_t = value
    })
}
```

# è¿›ç¨‹ã€çº¿ç¨‹é€šè®¯æ–¹å¼

## è¿›ç¨‹ IPC(Inter-Process Communication)

1. ç®¡é“
2. æ¶ˆæ¯é˜Ÿåˆ—
3. å…±äº«å†…å­˜
4. ä¿¡å·(signal)
5. ä¿¡å·é‡(semaphore)
6. å¥—æ¥å£(Socket)

## çº¿ç¨‹

1. é”
2. ä¿¡å·é‡
3. å…¨å±€å˜é‡-å…±äº«å†…å­˜
4. wait/notifyé˜»å¡/å”¤é†’

## æ­»é”çš„4ä¸ªå¿…è¦æ¡ä»¶
1. äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚
2. å æœ‰ä¸”ç­‰å¾…ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚
3. ä¸å¯å¼ºè¡Œå æœ‰:è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚
4. å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚

# osiä¸ƒå±‚æ¨¡å‹ã€äº”å±‚æ¨¡å‹

1. ç‰©ç†å±‚ï¼Œæ•°æ®é“¾è·¯å±‚ï¼Œç½‘ç»œå±‚ï¼Œä¼ è¾“å±‚ï¼Œä¼šè¯å±‚ï¼Œè¡¨ç¤ºå±‚ï¼Œåº”ç”¨å±‚
2. ç‰©ç†å±‚ï¼Œæ•°æ®é“¾è·¯å±‚ï¼Œç½‘ç»œå±‚ï¼Œä¼ è¾“å±‚ï¼Œåº”ç”¨å±‚
3. ç½‘ç»œæ¥å£å±‚ï¼Œç½‘é™…å±‚ï¼Œä¼ è¾“å±‚ï¼Œåº”ç”¨å±‚

# ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹

## ä¸‰æ¬¡æ¡æ‰‹

1. å®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚ï¼Œsyn = 1ï¼Œseq = xï¼Œè¿›å…¥syn_sendçŠ¶æ€ï¼ˆè¯·æ±‚ä¿¡æ¯åŒ…å«ç«¯å£å·ï¼Œåˆå§‹åºåˆ—å·xï¼‰
2. æœåŠ¡å™¨å›ç¡®è®¤åŒ…ï¼Œsyn = 1ï¼Œseq = yï¼Œ ack = 1ï¼Œ acknum = x + 1ï¼Œè¿›å…¥syc_rcvdçŠ¶æ€
3. å®¢æˆ·ç«¯å‘é€ç¡®è®¤åŒ…ï¼Œsyn = 0ï¼Œack = 1ï¼Œacknum = y + 1ï¼Œè¿›å…¥establishçŠ¶æ€ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ååŒæ ·è¿›å…¥

## å››æ¬¡æŒ¥æ‰‹ï¼ˆå®¢æˆ·ç«¯ä¸ºä¾‹ï¼‰

1. å®¢æˆ·ç«¯å‘å‡ºå¯ä»¥ç»“æŸä¿¡æ¯ï¼Œfin = 1ï¼Œseq = xï¼Œè¿›å…¥fin_wait_1çŠ¶æ€ï¼ˆè¡¨ç¤ºæ— æ•°æ®å¯å‘ï¼Œä½†ä»ç„¶æ¥æ”¶æ•°æ®ï¼‰
2. æœåŠ¡å™¨ç¡®è®¤å›åŒ…ï¼Œack = 1ï¼Œ acknum = x + 1ï¼Œè¿›å…¥close_waitçŠ¶æ€ï¼ˆè¡¨ç¤ºæ”¶åˆ°å®¢æˆ·ç«¯å…³é—­è¯·æ±‚ï¼Œä½†è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼‰ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åè¿›å…¥fin_wait_2çŠ¶æ€
3. æœåŠ¡å™¨å‘åŒ…ï¼Œfin = 1ï¼Œseq = yï¼Œè¿›å…¥last_ackçŠ¶æ€ï¼ˆè¡¨ç¤ºå·²ç»å¯ä»¥å…³é—­ï¼Œç­‰å®¢æˆ·ç«¯çš„æœ€åä¸€ä¸ªackï¼‰
4. å®¢æˆ·ç«¯å›åŒ…ï¼Œack = 1ï¼Œacknum = y + 1ï¼Œè¿›å…¥time_waitçŠ¶æ€ï¼ˆè¡¨ç¤ºå¯ä»¥å…³é—­ï¼Œå¹¶ç­‰å¾…å¯èƒ½å‡ºç°çš„ackåŒ…ï¼‰ã€‚ã€‚æœåŠ¡å™¨æ”¶åˆ°ç¡®è®¤åŒ…ï¼Œå…³é—­è¿æ¥ï¼Œè¿›å…¥closeçŠ¶æ€ã€‚ã€‚å®¢æˆ·ç«¯ç­‰ä¸€å®šçš„æ—¶é—´ï¼ˆä¸¤ä¸ªæœ€å¤§æ®µç”Ÿå‘½å‘¨æœŸï¼Œ2MSLï¼Œ2 Maximum Segment Lifttimeï¼‰ï¼Œæ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨ackå›ä¼ ï¼Œå°±è®¤ä¸ºæˆåŠŸå…³é—­ï¼Œè‡ªå·±è¿›å…¥closeçŠ¶æ€

# é“¶è¡Œå®¶ç®—æ³•

# å†…å­˜åˆ†é¡µåˆ†æ®µ

# 4kå¯¹é½

# CPUå¯†é›†å‹å’ŒIOå¯†é›†å‹
> CPUå¯†é›†å‹ä¹Ÿæ˜¯æŒ‡è®¡ç®—å¯†é›†å‹ï¼Œå¤§éƒ¨åˆ†æ—¶é—´ç”¨æ¥åšè®¡ç®—é€»è¾‘åˆ¤æ–­ç­‰CPUåŠ¨ä½œçš„ç¨‹åºç§°ä¸ºCPUå¯†é›†å‹ä»»åŠ¡ã€‚è¯¥ç±»å‹çš„ä»»åŠ¡éœ€è¦è¿›è¡Œå¤§é‡çš„è®¡ç®—ï¼Œä¸»è¦æ¶ˆè€—CPUèµ„æºã€‚è¿™ç§è®¡ç®—å¯†é›†å‹ä»»åŠ¡è™½ç„¶ä¹Ÿå¯ä»¥ç”¨å¤šä»»åŠ¡å®Œæˆï¼Œä½†æ˜¯ä»»åŠ¡è¶Šå¤šï¼ŒèŠ±åœ¨ä»»åŠ¡åˆ‡æ¢çš„æ—¶é—´å°±è¶Šå¤šï¼ŒCPUæ‰§è¡Œä»»åŠ¡çš„æ•ˆç‡å°±è¶Šä½ï¼Œæ‰€ä»¥ï¼Œè¦æœ€é«˜æ•ˆåœ°åˆ©ç”¨CPUï¼Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡åŒæ—¶è¿›è¡Œçš„æ•°é‡åº”å½“ç­‰äºCPUçš„æ ¸å¿ƒæ•°ã€‚
>
> IOå¯†é›†å‹ä»»åŠ¡æŒ‡ä»»åŠ¡éœ€è¦æ‰§è¡Œå¤§é‡çš„IOæ“ä½œï¼Œæ¶‰åŠåˆ°ç½‘ç»œã€ç£ç›˜IOæ“ä½œï¼Œå¯¹CPUæ¶ˆè€—è¾ƒå°‘ã€‚

# å’Œçº¿ç¨‹æ± é…ç½®çš„å…³ç³»
> CPUå¯†é›†å‹ä»»åŠ¡åº”é…ç½®å°½å¯èƒ½å°çš„çº¿ç¨‹ï¼Œå¦‚é…ç½®CPUæ•°ç›®+1ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ç”±äºIOå¯†é›†å‹ä»»åŠ¡çº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™åº”é…ç½®å°½å¯èƒ½å¤šçš„çº¿ç¨‹ï¼Œå¦‚2*CPUæ•°ç›®ã€‚

# ä¸‰åºéå†

```swift
class Stack<Element> {
    var data = [Element?]()
    func pop() -> Element? {
        let ret = data.last ?? nil
        data = Array(data.dropLast())
        return ret
    }
    
    func push(_ e: Element?) {
        data.append(e)
    }
    
    func isEmpty() -> Bool { return data.filter{ $0 != nil }.count <= 0 }
}

class TreeNode {
    var left: TreeNode?
    var right: TreeNode?
    
    private var _value: Int = 0
    var value: Int {
        get {
            return _value
        }
        set {
            _value = newValue
        }
    }
    
    init(_ value: Int, left: TreeNode? = nil, right: TreeNode? = nil) {
        self.value = value
        self.left = left
        self.right = right
    }
}

func visit(_ node: TreeNode) {
    print(node.value)
}
```
```swift
//å…ˆåºéå†
func preOrderRecursion(node: TreeNode?) {
    guard let node = node else {
        return
    }
    visit(node)
    preOrderRecursion(node: node.left)
    preOrderRecursion(node: node.right)
}

func preOrderTraversal(node: TreeNode?) {
    guard let node = node else {
        return
    }
    let stack = Stack<TreeNode>()
    stack.push(node)
    while !stack.isEmpty() {
        if let currentNode = stack.pop() {
            visit(currentNode)
            stack.push(currentNode.right)
            stack.push(currentNode.left)
        }
    }
}

```
```swift
//ä¸­åºéå†
func inOrderRecursion(node: TreeNode?) {
    guard let node = node else {
        return
    }
    inOrderRecursion(node: node.left)
    visit(node)
    inOrderRecursion(node: node.right)
}

func inOrderTraversal(node: TreeNode?) {
    guard let node = node else {
        return
    }
    let stack = Stack<TreeNode>()
    var currentNode: TreeNode? = node
    
    while currentNode != nil || !stack.isEmpty() {
        while currentNode != nil {
            stack.push(currentNode)
            currentNode = currentNode?.left
        }
        currentNode = stack.pop()
        visit(currentNode!)
        currentNode = currentNode?.right
    }
}

```
```swift
//ååºéå†
func postOrderRecursion(node: TreeNode?) {
    guard let node = node else {
        return
    }
    postOrderRecursion(node: node.left)
    postOrderRecursion(node: node.right)
    visit(node)
}

func postOrderTraversal(node: TreeNode?) {
    let stack = Stack<TreeNode>()
    var ret = [TreeNode]()
    stack.push(node)
    while !stack.isEmpty() {
        if let curNode = stack.pop() {
            ret.append(curNode)
            stack.push(curNode.left)
            stack.push(curNode.right)
        }
    }
    for node in ret.reversed() {
        print(node.value)
    }
}
```

# äº‹ä»¶ä¼ é€’ï¼Œå“åº”é“¾

iosäº‹ä»¶å¯ä»¥åˆ†ä¸º3ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼šè§¦æ‘¸äº‹ä»¶ï¼ŒåŠ é€Ÿè®¡äº‹ä»¶ï¼Œè¿œç¨‹æ§åˆ¶äº‹ä»¶ã€‚

å½“æˆ‘ä»¬ç‚¹å‡»å±å¹•çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå°†è¿™ä¸ªåŠ¨ä½œåŒ…è£…ä¸ºUIEventå’ŒUITouchçš„å¯¹è±¡ï¼Œæ‰¾åˆ°å½“å‰è¿è¡Œçš„appï¼Œå°†è¿™ä¸ªç‚¹å‡»æ“ä½œä¼ é€’ï¼Œå¯»æ‰¾èƒ½å¤Ÿå¤„ç†çš„å¯¹è±¡ã€‚

1. æˆ‘ä»¬ç‚¹å‡»å±å¹•äº§ç”Ÿè§¦æ‘¸äº‹ä»¶ï¼Œç³»ç»Ÿå°†è¿™ä¸ªäº‹ä»¶åŠ å…¥åˆ°ä¸€ä¸ªç”±UIApplicationç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼ŒUIApplicationä¼šä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œå–äº‹ä»¶åˆ†å‘ä¸‹å»ï¼Œé¦–å…ˆä¼ ç»™UIWindow
2. åœ¨UIWindowä¸­å°±ä¼šè°ƒç”¨hitTest:withEvent:æ–¹æ³•å»è¿”å›ä¸€ä¸ªæœ€ç»ˆå“åº”çš„è§†å›¾
3. åœ¨hitTest:withEvent:æ–¹æ³•ä¸­å°±ä¼šå»è°ƒç”¨pointInside: withEvent:å»åˆ¤æ–­å½“å‰ç‚¹å‡»çš„pointæ˜¯å¦åœ¨UIWindowèŒƒå›´å†…ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±ä¼šå»éå†å®ƒçš„å­è§†å›¾æ¥æŸ¥æ‰¾æœ€ç»ˆå“åº”çš„å­è§†å›¾
4. éå†çš„æ–¹å¼æ˜¯ä½¿ç”¨å€’åºçš„æ–¹å¼æ¥éå†å­è§†å›¾ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åæ·»åŠ çš„å­è§†å›¾ä¼šæœ€å…ˆéå†ï¼Œåœ¨æ¯ä¸€ä¸ªè§†å›¾ä¸­éƒ½å›å»è°ƒç”¨å®ƒçš„hitTest:withEvent:æ–¹æ³•ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªé€’å½’è°ƒç”¨
5. æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªå“åº”è§†å›¾ï¼Œå¦‚æœè¿”å›è§†å›¾æœ‰å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªè§†å›¾å°±ä½œä¸ºæœ€ç»ˆå“åº”è§†å›¾ï¼Œç»“æŸæ•´ä¸ªäº‹ä»¶ä¼ é€’ï¼›å¦‚æœæ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆå°±ä¼šå°†UIWindowä½œä¸ºå“åº”è€…

1. å¦‚æœviewçš„æ§åˆ¶å™¨å­˜åœ¨ï¼Œå°±ä¼ é€’ç»™æ§åˆ¶å™¨å¤„ç†ï¼›å¦‚æœæ§åˆ¶å™¨ä¸å­˜åœ¨ï¼Œåˆ™ä¼ é€’ç»™å®ƒçš„çˆ¶è§†å›¾
2. åœ¨è§†å›¾å±‚æ¬¡ç»“æ„çš„æœ€é¡¶å±‚ï¼Œå¦‚æœä¹Ÿä¸èƒ½å¤„ç†æ”¶åˆ°çš„äº‹ä»¶ï¼Œåˆ™å°†äº‹ä»¶ä¼ é€’ç»™UIWindowå¯¹è±¡è¿›è¡Œå¤„ç†
3. å¦‚æœUIWindowå¯¹è±¡ä¹Ÿä¸å¤„ç†ï¼Œåˆ™å°†äº‹ä»¶ä¼ é€’ç»™UIApplicationå¯¹è±¡
4. å¦‚æœUIApplicationä¹Ÿä¸èƒ½å¤„ç†è¯¥äº‹ä»¶ï¼Œåˆ™å°†è¯¥äº‹ä»¶ä¸¢å¼ƒ

https://www.jianshu.com/p/2e074db792ba

# å†…å­˜ç®¡ç†

![](../Images/2021-04-21-14-38-44.png)



# ä»ç¼–è¯‘åˆ°ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶éƒ½åšäº†ä»€ä¹ˆ
# gcd blockæ”¾å“ªé‡Œï¼Œ ç”Ÿæˆä¸€ä¸ªnsstringå¯¹è±¡æ”¾å“ªé‡Œ
# autoreleasepool
# layoutSubViews    drawRectxxxx

# NSNotificationåŸç†

- æ”¶å‘ä¸åœ¨ç›¸åŒçº¿ç¨‹ä¼šæœ‰é—®é¢˜å—

# [abc](https://github.com/ChenYilong/iOSInterviewQuestions)
# [abc](https://zhuanlan.zhihu.com/p/77892343)
# [abc](https://zhuanlan.zhihu.com/p/77789398)
# [abc](https://hit-alibaba.github.io/interview/iOS/ObjC-Basic/Runloop.html)

# kvo

# methond swizzling

# ocåˆ†ç±»ï¼Œæ‰©å±•ï¼›åˆ†ç±»æ˜¯ä»€ä¹ˆè®¾è®¡æ¨¡å¼

# propertyä¿®é¥°ç¬¦ 


# å¯»æ‰¾viewçš„çˆ¶VC
# runtimeå®ç°weakå±æ€§
# autoreleasePool å¯¹è±¡ä½•æ—¶åŠ å…¥å…¶ä¸­
# å¼•ç”¨è®¡æ•°æ˜¯è°åœ¨è®¡æ•°
# å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–ï¼ŒåŒ…å¤§å°ä¼˜åŒ–

# ç®—æ³•
1. å•é“¾è¡¨åè½¬
2. äºŒå‰æ ‘åè½¬
3. äºŒå‰æ ‘æ˜¯å¦é•œåƒå¯¹ç§°